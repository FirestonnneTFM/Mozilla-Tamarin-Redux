# ***** BEGIN LICENSE BLOCK *****
# Version: MPL 1.1/GPL 2.0/LGPL 2.1
#
# The contents of this file are subject to the Mozilla Public License Version
# 1.1 (the "License"); you may not use this file except in compliance with
# the License. You may obtain a copy of the License at
# http://www.mozilla.org/MPL/
#
# Software distributed under the License is distributed on an "AS IS" basis,
# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License
# for the specific language governing rights and limitations under the
# License.
#
# The Original Code is [Open Source Virtual Machine.].
#
# The Initial Developer of the Original Code is
# Adobe System Incorporated.
# Portions created by the Initial Developer are Copyright (C) 2010
# the Initial Developer. All Rights Reserved.
#
# Contributor(s):
#   Adobe AS3 Team
#
# Alternatively, the contents of this file may be used under the terms of
# either the GNU General Public License Version 2 or later (the "GPL"), or
# the GNU Lesser General Public License Version 2.1 or later (the "LGPL"),
# in which case the provisions of the GPL or the LGPL are applicable instead
# of those above. If you wish to allow use of your version of this file only
# under the terms of either the GPL or the LGPL, and not to allow others to
# use your version of this file under the terms of the MPL, indicate your
# decision by deleting the provisions above and replace them with the notice
# and other provisions required by the GPL or the LGPL. If you do not delete
# the provisions above, a recipient may use your version of this file under
# the terms of any one of the MPL, the GPL or the LGPL.
#
# ***** END LICENSE BLOCK *****

.SUFFIXES:
.SUFFIXES: .as .abc .js

ASC ?= $(HOME)/lib/asc.jar
AVM ?= ../../../platform/mac/avmshell/build/Release/shell

ASC_ARGS = -optimize

# Targets generated by this expression:
#
#   ls *-[0-9]*.js | sed 's/\.js$/\.abc/g' | awk '{ s = s " " $1 } END { print "TARGETS=" s }'
#
# It should be possible to insert that into the makefile and have the
# target list generated automatically but I've had no luck getting
# that to work.

TARGETS= alloc-1.abc alloc-10.abc alloc-11.abc alloc-12.abc alloc-13.abc alloc-14.abc alloc-2.abc alloc-3.abc alloc-4.abc alloc-5.abc alloc-6.abc alloc-7.abc alloc-8.abc alloc-9.abc arguments-1.abc arguments-2.abc arguments-3.abc array-1.abc array-2.abc array-pop-1.abc array-push-1.abc array-shift-1.abc array-slice-1.abc array-sort-1.abc array-sort-2.abc array-sort-3.abc array-sort-4.abc array-unshift-1.abc closedvar-read-1.abc closedvar-write-1.abc closedvar-write-2.abc do-1.abc for-1.abc for-2.abc for-3.abc for-in-1.abc for-in-2.abc funcall-1.abc funcall-2.abc funcall-3.abc funcall-4.abc globalvar-read-1.abc globalvar-write-1.abc isNaN-1.abc lookup-array-fetch-1.abc lookup-array-in-1.abc lookup-object-fetch-1.abc lookup-object-in-1.abc number-toString-1.abc number-toString-2.abc oop-1.abc parseFloat-1.abc parseInt-1.abc regex-exec-1.abc regex-exec-2.abc regex-exec-3.abc regex-exec-4.abc string-casechange-1.abc string-casechange-2.abc string-charAt-1.abc string-charAt-2.abc string-charCodeAt-1.abc string-charCodeAt-2.abc string-fromCharCode-1.abc string-fromCharCode-2.abc string-fromCharCode-3.abc string-fromCharCode-4.abc string-indexOf-1.abc string-indexOf-2.abc string-indexOf-3.abc string-lastIndexOf-1.abc string-lastIndexOf-2.abc string-lastIndexOf-3.abc string-slice-1.abc string-split-1.abc string-split-2.abc string-substring-1.abc switch-1.abc switch-2.abc switch-3.abc try-1.abc try-2.abc try-3.abc while-1.abc

%.abc : %.as %.js
	java -jar $(ASC) -import ../../../generated/builtin.abc -import ../../../generated/shell_toplevel.abc $(ASC_ARGS) $<

all: $(TARGETS)

run: $(TARGETS)
	for i in $(TARGETS); do $(AVM) $$i ; done

clean:
	rm -f *.abc *~

*.abc: driver.js Makefile

